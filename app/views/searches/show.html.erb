<%= render 'form' %>

<%# line_chart Project.where(id: @found_search.projects.pluck(:id)).group_by_month(:created_at).sum(:budget_margin) %>
<% current_data = Project.where(id: @found_search.projects.pluck(:id)).group_by_month(:created_at).sum(:budget_margin) %>

<div id="year-sold-pos" style="height: 250px;"></div>
<script>
new Morris.Line({
  element: 'year-sold-pos',
  data: [
    <% 
    def month_year(d)
      d.strftime("%B %Y")
    end
    current_data.each do |d| 
    
      tmp_date = d[0].to_datetime
      month_str = tmp_date.strftime("%b, %Y") %>
    <%= 
    "{ Year: \"#{tmp_date}\" , a:".html_safe + d[1].to_s + "},"
    %>

    <% end %>
  ],
  xkey: 'Year',
  ykeys: ['a'],
  labels: ['Live Data'],
  lineColors: ['#0a85ee'],
  lineWidth: [ '3'],
  hideHover: 'auto',
  continuousLine: 'true',
  resize: 'true'
  });
</script>

<h1>Results</h1>
<% if @found_search.projects.empty? %>
    <p>No Records Found</p>
<% else %>
    <table class="table">
  <thead>
    <tr>
      <th>Client</th>
      <th>Project status</th>
      <th>Project name</th>
      <th>Completion date</th>
      <th>Completion month</th>
      <th>Budget revenue</th>
      <th>Budget margin</th>
      <th>Budget margin %</th>
      <th>Date Updated</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody> 
    <% @found_search.projects.each do |project| %>
      <tr>
        <td><%= project.client %></td>
        <td><%= project.project_status %></td>
        <td><%= project.project_name %></td>
        <td><%= project.completion_date %></td>
        <td><%= project.completion_month %></td>
        <td><%= project.budget_revenue %></td>
        <td><%= project.budget_margin %></td>
        <td><%= project.budget_margin_pct %></td>
        <td><%= project.updated_at %></td>
        <td><%= link_to 'Show', project %></td>
        <td><%= link_to 'Edit', edit_project_path(project) %></td>
        <td><%= link_to 'Destroy', project, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<% end %>
